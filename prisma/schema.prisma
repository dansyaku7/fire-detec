// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl      = env("SHADOW_DATABASE_URL")
}

// --- MODEL UNTUK APLIKASI DETEKSI KEBAKARAN ---

model Room {
  id        String   @id @default(cuid())
  name      String
  floor     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sensors   Sensor[]
  logs      Log[]
}

enum SensorType {
  SMOKE
  HEAT
  BREAKING_GLASS
}

model Sensor {
  id          String     @id @default(cuid())
  // KTP UNIK DARI PERANGKAT KERAS ESP
  macAddress  String     @unique 
  type        SensorType
  status      String     @default("Normal")
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  room        Room       @relation(fields: [roomId], references: [id], onDelete: Cascade)
  roomId      String
  data        SensorData[]
}

model SensorData {
  id        String   @id @default(cuid())
  value     Float
  timestamp DateTime @default(now())
  sensor    Sensor   @relation(fields: [sensorId], references: [id], onDelete: Cascade)
  sensorId  String
}

enum LogLevel {
  INFO
  WARNING
  CRITICAL
  MANUAL
}

model Log {
  id          String   @id @default(cuid())
  level       LogLevel
  message     String
  information String?
  timestamp   DateTime @default(now())
  room        Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  roomId      String
}

model User {
  id        String   @id @default(cuid())
  fullName  String
  email     String   @unique
  password  String
  role      String   @default("Admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Setting {
  key   String @id
  value String
}

// +++ MODEL BARU UNTUK PENDAFTARAN OTOMATIS +++
// Model ini untuk menampung sensor yang terdeteksi oleh gateway
// tapi belum di-assign ke ruangan manapun oleh admin.
model UnassignedDevice {
  macAddress String   @id @unique
  firstSeen  DateTime @default(now())
}
